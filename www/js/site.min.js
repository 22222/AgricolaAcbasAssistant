!function(){ko.extenders.boundedInt=function(e,n){var o=ko.computed({read:e,write:function(o){var r=ko.utils.unwrapObservable(n.min),t=ko.utils.unwrapObservable(n.max),a=e(),l=parseInt(o,10);(""===o||"-"===o)&&0>r?l=o:"number"!=typeof l||isNaN(l)?l=null:r>l?l=r:l>t&&(l=t),l!==a?e(l):o!=a&&e.notifySubscribers(l)}});return o(e()),o},ko.bindingHandlers.pageTitle={update:function(e,n){var o=ko.utils.unwrapObservable(n());document.title=o}},ko.virtualElements.allowedBindings.pageTitle=!0}(),function(){"use strict";var e=function(){var e={};return{addCultureInfo:function(n,o){e[n]=o},localize:function(n,o){o||(o="en");var r=o.substring(0,2),t=e[r]||e.en||{},a=t.messages||{};return a[n]}}}();e.addCultureInfo("en",{messages:{title:"Agricola All Creatures Big and Small Scorecard",shortTitle:"Agricola ACBAS Scorecard",loading:"Loading",details:"Details",clear:"Clear"}}),e.addCultureInfo("fr",{name:"fr",language:"fr",messages:{title:"Agricola Terres d'Élevage Scorecard",shortTitle:"Agricola Terres d'Élevage Scorecard",loading:"Chargement",details:"Détails",clear:"Nettoyer"}}),e.addCultureInfo("de",{name:"de",language:"de",messages:{title:"Agricola Die Bauern und das liebe Vieh Scorecard",shortTitle:"Agricola DBUDLV Scorecard",loading:"Wird geladen",details:"Details",clear:"Löschen"}});var n=function(){var e=new Deferred,n="en",o=function(){var o=navigator.language||navigator.userLanguage;e.resolve(o||n)},r=function(){navigator.globalization.getPreferredLanguage(function(o){var r;"English"===o.value?r="en":"German"===o.value?r="de":"French"===o.value&&(r="fr"),e.resolve(r||n)},function(){o()})};return navigator&&navigator.globalization&&navigator.globalization.getPreferredLanguage?r():navigator?o():e.resolve(n),e.promise()},o=function(){var n=300,o=function(e){var o={category:e,count:ko.observable().extend({boundedInt:{min:e.min,max:e.max}})};return o.decrement=function(){o.count(o.count()-1)},o.isDecrementDisabled=ko.computed(function(){return o.count()<=e.min}).extend({throttle:n}),o.increment=function(){o.count(o.count()+1)},o.isIncrementDisabled=ko.computed(function(){return o.count()>=e.max}).extend({throttle:n}),o.clear=function(){o.count(null)},o},r=function(e,n,o,r){r=r||{},r.min=r.min||0,r.max=r.max||99;var t={id:e,iconName:n,min:r.min,max:r.max};return t.createScoreModel=function(){return o(t)},t},t=function(e,r){var t=o(e);return t.score=ko.computed(function(){var e,n=t.count();return e=3>=n?-3:n<=r.level0End?0:n<=r.level1End?1:n<=r.level2End?2:3+(n-r.level3),n+e}).extend({throttle:n}),t},a=function(e,r){r=r||{},r.scoreMultiplier=r.scoreMultiplier||1;var t=o(e);return t.score=ko.computed(function(){return t.count()*r.scoreMultiplier}).extend({throttle:n}),t},l=[r("sheepCount","sheep",function(e){return t(e,{level0End:7,level1End:10,level2End:12,level3:13})}),r("pigCount","pig",function(e){return t(e,{level0End:6,level1End:8,level2End:10,level3:11})}),r("cowCount","cow",function(e){return t(e,{level0End:5,level1End:7,level2End:9,level3:10})}),r("horseCount","horse",function(e){return t(e,{level0End:4,level1End:6,level2End:8,level3:9})}),r("completedExpansionCount","expansion",function(e){return a(e,{scoreMultiplier:4})},{max:4}),r("buildingScore","buildingscore",a)],i=function(e){var n={id:"player-"+e,color:e},o=[],r={};return _.map(l,function(e){var n=e.createScoreModel();o.push(n),r[e.id]=n}),n.getScoreModelForCategory=function(e){return r[e]},n.scoreTotal=ko.computed(function(){for(var e=0,n=0;n<o.length;n++){var r=o[n];e+=r.score()}return e}),n.clear=function(){for(var e=0;e<o.length;e++){var n=o[e];n.clear()}},n.toJS=function(){var e={};return _.each(o,function(n){e[n.category.id]=n.count()}),e},n.fromJS=function(e){return e?void _.each(e,function(e,o){var r=n.getScoreModelForCategory(o);r&&r.count(e)}):void n.clear()},n},u=i("red"),c=i("blue"),d=[u,c],s={players:d,categories:l,isScoreDetailShown:ko.observable(!1)};return s.toggleScoreDetailShown=function(){s.isScoreDetailShown(!s.isScoreDetailShown())},s.clear=function(){for(var e=0;e<s.players.length;e++)s.players[e].clear()},s.toJS=function(){var e={};return e.playerRed=u.toJS(),e.playerBlue=c.toJS(),e},s.toJSON=function(){var e=s.toJS();return JSON.stringify(e)},s.fromJS=function(e){e||(e={}),u.fromJS(e.playerRed),c.fromJS(e.playerBlue)},s.saveToLocalStorage=function(){if(window.localStorage){var e=s.toJS(),n=JSON.stringify(e);window.localStorage.setItem("agricola_2p.currentGame",n)}},s.loadFromLocalStorage=function(){if(window.localStorage)try{var e=window.localStorage.getItem("agricola_2p.currentGame"),n=JSON.parse(e);"object"==typeof n&&null!==n&&s.fromJS(n)}catch(o){window.console&&console.log(o)}},s.cultureName=ko.observable("default"),s.messages={title:ko.computed(function(){return e.localize("title",s.cultureName())}),shortTitle:ko.computed(function(){return e.localize("shortTitle",s.cultureName())}),loading:ko.computed(function(){return e.localize("loading",s.cultureName())}),details:ko.computed(function(){return e.localize("details",s.cultureName())}),clear:ko.computed(function(){return e.localize("clear",s.cultureName())})},s.isLoaded=ko.observable(!1),s},r=function(e){e.loadFromLocalStorage(),window.onunload=e.saveToLocalStorage,document.addEventListener("deviceready",function(){document.addEventListener("pause",e.saveToLocalStorage,!1)},!1)},t=function(){var e=o();n().done(function(n){n&&e.cultureName(n)}),r(e),ko.applyBindings(e),e.isLoaded(!0)};setTimeout(t)}();